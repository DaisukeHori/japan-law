<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>法案一覧 - 日本法令データベース</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-blue-900 text-white py-6">
    <div class="max-w-6xl mx-auto px-4">
      <nav class="text-blue-200 text-sm mb-2">
        <a href="../" class="hover:underline">ホーム</a> &gt; 法案一覧
      </nav>
      <h1 class="text-3xl font-bold">📋 法案一覧</h1>
      <p class="text-blue-200 mt-1">国会に提出された法律案（スマートニュースMRIデータ）</p>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- フィルター -->
    <section class="bg-white rounded-lg shadow-md p-4 mb-6">
      <div class="flex flex-wrap gap-4 items-center">
        <div>
          <label class="text-sm text-gray-600">状態</label>
          <select id="filterStatus" class="ml-2 rounded border-gray-300 text-sm">
            <option value="">全て</option>
            <option value="成立">成立</option>
            <option value="審議中">審議中</option>
            <option value="廃案">廃案</option>
            <option value="撤回">撤回</option>
            <option value="継続審議">継続審議</option>
          </select>
        </div>
        
        <div>
          <label class="text-sm text-gray-600">種別</label>
          <select id="filterType" class="ml-2 rounded border-gray-300 text-sm">
            <option value="">全て</option>
            <option value="閣法">閣法（内閣提出）</option>
            <option value="衆法">衆法（衆議院議員提出）</option>
            <option value="参法">参法（参議院議員提出）</option>
          </select>
        </div>
        
        <div class="flex-1">
          <input 
            type="text" 
            id="searchInput"
            placeholder="法案名で検索..."
            class="w-full max-w-xs rounded border-gray-300 text-sm px-3 py-2"
          >
        </div>
      </div>
    </section>

    <!-- 統計 -->
    <section class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-blue-600" id="stat-total">0</div>
        <div class="text-sm text-gray-500">総法案数</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-green-600" id="stat-passed">0</div>
        <div class="text-sm text-gray-500">成立</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-yellow-600" id="stat-pending">0</div>
        <div class="text-sm text-gray-500">審議中</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-red-600" id="stat-rejected">0</div>
        <div class="text-sm text-gray-500">廃案</div>
      </div>
      <div class="bg-white rounded-lg shadow p-4 text-center">
        <div class="text-2xl font-bold text-purple-600" id="stat-rate">0%</div>
        <div class="text-sm text-gray-500">成立率</div>
      </div>
    </section>

    <!-- 結果 -->
    <section class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="p-4 border-b">
        <span id="resultCount" class="text-gray-600">読み込み中...</span>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">法案名</th>
              <th class="px-4 py-3 text-left text-sm font-semibold text-gray-600">提出者</th>
              <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">種別</th>
              <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">状態</th>
              <th class="px-4 py-3 text-center text-sm font-semibold text-gray-600">国会</th>
            </tr>
          </thead>
          <tbody id="billsTable" class="divide-y">
          </tbody>
        </table>
      </div>
      
      <!-- ページネーション -->
      <div id="pagination" class="p-4 border-t flex justify-center gap-2">
        <button id="prevBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50">前へ</button>
        <span id="pageInfo" class="px-4 py-2"></span>
        <button id="nextBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50">次へ</button>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-400 py-6 mt-8">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p>© 2025 Japan Law Database Project</p>
      <p class="text-sm mt-2">
        議案データは<a href="https://github.com/smartnews-smri" class="text-blue-400 hover:underline">スマートニュース メディア研究所</a>より取得（MIT License）
      </p>
    </div>
  </footer>

  <script>
    let bills = [];
    let filteredBills = [];
    let currentPage = 1;
    const perPage = 50;

    const statusColors = {
      '成立': 'bg-green-100 text-green-800',
      '審議中': 'bg-yellow-100 text-yellow-800',
      '廃案': 'bg-red-100 text-red-800',
      '撤回': 'bg-gray-100 text-gray-800',
      '継続審議': 'bg-blue-100 text-blue-800',
    };

    const typeColors = {
      '閣法': 'bg-purple-100 text-purple-800',
      '衆法': 'bg-orange-100 text-orange-800',
      '参法': 'bg-pink-100 text-pink-800',
    };

    async function loadData() {
      try {
        const response = await fetch('../data/index/legislators/smri_bills.json');
        const data = await response.json();
        bills = data.bills || [];
        
        updateStats();
        applyFilters();
      } catch (e) {
        console.error('Failed to load bills:', e);
        document.getElementById('resultCount').textContent = 'データの読み込みに失敗しました';
      }
    }

    function updateStats() {
      const total = bills.length;
      const passed = bills.filter(b => b.status === '成立').length;
      const pending = bills.filter(b => b.status === '審議中').length;
      const rejected = bills.filter(b => b.status === '廃案').length;
      const rate = total > 0 ? ((passed / total) * 100).toFixed(1) : 0;

      document.getElementById('stat-total').textContent = total.toLocaleString();
      document.getElementById('stat-passed').textContent = passed.toLocaleString();
      document.getElementById('stat-pending').textContent = pending.toLocaleString();
      document.getElementById('stat-rejected').textContent = rejected.toLocaleString();
      document.getElementById('stat-rate').textContent = rate + '%';
    }

    function applyFilters() {
      const status = document.getElementById('filterStatus').value;
      const type = document.getElementById('filterType').value;
      const query = document.getElementById('searchInput').value.toLowerCase();

      filteredBills = bills.filter(b => {
        if (status && b.status !== status) return false;
        if (type && b.proposer_type !== type) return false;
        if (query && !b.bill_name.toLowerCase().includes(query)) return false;
        return true;
      });

      // 新しい順にソート
      filteredBills.sort((a, b) => b.diet_session - a.diet_session);

      currentPage = 1;
      renderTable();
    }

    function renderTable() {
      const start = (currentPage - 1) * perPage;
      const end = start + perPage;
      const pageBills = filteredBills.slice(start, end);

      const tbody = document.getElementById('billsTable');
      tbody.innerHTML = pageBills.map(b => `
        <tr class="hover:bg-gray-50">
          <td class="px-4 py-3">
            <div class="font-medium text-gray-900">${b.bill_name}</div>
          </td>
          <td class="px-4 py-3 text-sm text-gray-600">${b.proposer || '-'}</td>
          <td class="px-4 py-3 text-center">
            <span class="px-2 py-1 text-xs rounded ${typeColors[b.proposer_type] || 'bg-gray-100'}">${b.proposer_type || '-'}</span>
          </td>
          <td class="px-4 py-3 text-center">
            <span class="px-2 py-1 text-xs rounded ${statusColors[b.status] || 'bg-gray-100'}">${b.status}</span>
          </td>
          <td class="px-4 py-3 text-center text-sm text-gray-600">第${b.diet_session}回</td>
        </tr>
      `).join('');

      document.getElementById('resultCount').textContent = `${filteredBills.length.toLocaleString()} 件`;

      // ページネーション
      const totalPages = Math.ceil(filteredBills.length / perPage);
      document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
      document.getElementById('prevBtn').disabled = currentPage === 1;
      document.getElementById('nextBtn').disabled = currentPage >= totalPages;
    }

    // イベントリスナー
    document.getElementById('filterStatus').addEventListener('change', applyFilters);
    document.getElementById('filterType').addEventListener('change', applyFilters);
    document.getElementById('searchInput').addEventListener('input', applyFilters);
    document.getElementById('prevBtn').addEventListener('click', () => { currentPage--; renderTable(); });
    document.getElementById('nextBtn').addEventListener('click', () => { currentPage++; renderTable(); });

    loadData();
  </script>
</body>
</html>
