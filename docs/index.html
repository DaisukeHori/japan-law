<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>日本法令データベース</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <header class="bg-blue-900 text-white py-8">
    <div class="max-w-6xl mx-auto px-4">
      <h1 class="text-4xl font-bold">🏛️ 日本法令データベース</h1>
      <p class="mt-2 text-blue-200">Japan Law Database - 相互参照・議員活動追跡機能付き</p>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- コンセプト説明 -->
    <section class="bg-gradient-to-r from-blue-800 to-indigo-900 text-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">💻 Laws as Code - 法律をプログラムとして管理</h2>
      <p class="text-blue-100 mb-4">
        このプロジェクトは、日本の法令をソースコードのように Git で管理するという実験的な取り組みです。
      </p>
      <div class="grid md:grid-cols-4 gap-4 mt-6 text-center text-sm">
        <div class="bg-white/10 rounded-lg p-3">
          <div class="text-2xl mb-1">📝</div>
          <div class="font-bold">Create</div>
          <div class="text-blue-200">新規法令 = git add</div>
        </div>
        <div class="bg-white/10 rounded-lg p-3">
          <div class="text-2xl mb-1">📖</div>
          <div class="font-bold">Read</div>
          <div class="text-blue-200">法令閲覧 = Browse</div>
        </div>
        <div class="bg-white/10 rounded-lg p-3">
          <div class="text-2xl mb-1">✏️</div>
          <div class="font-bold">Update</div>
          <div class="text-blue-200">法令改正 = git diff</div>
        </div>
        <div class="bg-white/10 rounded-lg p-3">
          <div class="text-2xl mb-1">🗑️</div>
          <div class="font-bold">Delete</div>
          <div class="text-blue-200">法令廃止 = git rm</div>
        </div>
      </div>
      <div class="flex flex-wrap gap-4 mt-6">
        <a href="https://github.com/DaisukeHori/japan-law"
           class="inline-flex items-center px-4 py-2 bg-white text-gray-900 rounded-lg hover:bg-gray-100">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          GitHubリポジトリ
        </a>
        <a href="https://github.com/DaisukeHori/japan-law/issues"
           class="inline-flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
          📋 法案（Issues）
        </a>
      </div>
    </section>

    <!-- メニュー -->
    <section class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">📖 法令検索</h3>
        <p class="text-gray-600 mb-4">憲法・法律・政令・省令など約8,000件の法令を検索・閲覧できます。</p>
        <a href="./search.html" class="text-blue-600 hover:underline">検索する →</a>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">👤 議員活動</h3>
        <p class="text-gray-600 mb-4">議員別・政党別の法案提出数、成功率などの統計を確認できます。</p>
        <a href="./legislators/" class="text-blue-600 hover:underline">議員一覧 →</a>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">🏢 政党統計</h3>
        <p class="text-gray-600 mb-4">政党ごとの活動状況、所属議員の法案提出傾向を分析します。</p>
        <a href="./parties/" class="text-blue-600 hover:underline">政党一覧 →</a>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">📋 法案一覧</h3>
        <p class="text-gray-600 mb-4">登録されている法案の一覧を確認できます。</p>
        <a href="./bills/" class="text-blue-600 hover:underline">法案一覧 →</a>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">🔗 参照グラフ</h3>
        <p class="text-gray-600 mb-4">法令間の参照関係をインタラクティブなグラフで可視化します。</p>
        <a href="./graph.html" class="text-blue-600 hover:underline">グラフを見る →</a>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <h3 class="text-xl font-bold mb-2">📜 改正履歴</h3>
        <p class="text-gray-600 mb-4">法令の改正履歴をGitの差分形式で確認できます。</p>
        <a href="./diff.html" class="text-blue-600 hover:underline">差分を見る →</a>
      </div>
    </section>

    <!-- 国会トラッキング -->
    <section class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-2xl font-bold mb-4">🏛️ 国会トラッキング</h2>
      <p class="text-gray-600 mb-4">
        GitHub Issues = 法案、PR Merge = 法案成立 として国会活動を追跡しています。
      </p>
      <div class="grid md:grid-cols-2 gap-6">
        <!-- 審議中の法案 -->
        <div>
          <h3 class="font-bold text-green-700 mb-2">📋 審議中の法案（Open Issues）</h3>
          <div id="open-issues" class="text-sm space-y-2 max-h-48 overflow-y-auto">
            <p class="text-gray-500">読み込み中...</p>
          </div>
          <a href="https://github.com/DaisukeHori/japan-law/issues?q=is%3Aissue+is%3Aopen+label%3A%E6%B3%95%E6%A1%88"
             target="_blank"
             class="text-blue-600 hover:underline text-sm mt-2 inline-block">
            すべての法案を見る →
          </a>
        </div>
        <!-- 最近の成立 -->
        <div>
          <h3 class="font-bold text-blue-700 mb-2">✅ 最近成立した法案（Closed Issues）</h3>
          <div id="closed-issues" class="text-sm space-y-2 max-h-48 overflow-y-auto">
            <p class="text-gray-500">読み込み中...</p>
          </div>
          <a href="https://github.com/DaisukeHori/japan-law/issues?q=is%3Aissue+is%3Aclosed+label%3A%E6%88%90%E7%AB%8B"
             target="_blank"
             class="text-blue-600 hover:underline text-sm mt-2 inline-block">
            成立法案一覧 →
          </a>
        </div>
      </div>
      <div class="mt-4 pt-4 border-t">
        <h3 class="font-bold text-purple-700 mb-2">📜 最近の法令更新（Recent Commits）</h3>
        <div id="recent-commits" class="text-sm space-y-2 max-h-32 overflow-y-auto">
          <p class="text-gray-500">読み込み中...</p>
        </div>
        <a href="./diff.html" class="text-blue-600 hover:underline text-sm mt-2 inline-block">
          改正履歴を詳しく見る →
        </a>
      </div>
    </section>

    <!-- 統計サマリー（プレースホルダー） -->
    <section class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-2xl font-bold mb-4">📊 統計サマリー</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-blue-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-blue-600" id="stat-laws">-</div>
          <div class="text-gray-600">法令数</div>
        </div>
        <div class="bg-green-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-green-600" id="stat-legislators">-</div>
          <div class="text-gray-600">議員数</div>
        </div>
        <div class="bg-yellow-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-yellow-600" id="stat-bills">-</div>
          <div class="text-gray-600">法案数</div>
        </div>
        <div class="bg-purple-50 rounded-lg p-4 text-center">
          <div class="text-3xl font-bold text-purple-600" id="stat-passed">-</div>
          <div class="text-gray-600">成立数</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="bg-gray-800 text-gray-400 py-6 mt-8">
    <div class="max-w-6xl mx-auto px-4 text-center">
      <p>© 2025 Japan Law Database Project</p>
      <p class="text-sm mt-2">
        法令データは<a href="https://laws.e-gov.go.jp/" class="text-blue-400 hover:underline">e-Gov法令検索</a>より取得
      </p>
    </div>
  </footer>

  <script>
    // 統計データを読み込んで表示
    async function loadStats() {
      try {
        const [lawsRes, statsRes] = await Promise.all([
          fetch('./data/index/laws.json'),
          fetch('./data/index/legislators/activity_stats.json')
        ]);

        const lawsData = await lawsRes.json();
        const statsData = await statsRes.json();

        document.getElementById('stat-laws').textContent = lawsData.total_count?.toLocaleString() || '0';
        document.getElementById('stat-legislators').textContent = statsData.summary?.total_legislators?.toLocaleString() || '0';
        document.getElementById('stat-bills').textContent = statsData.summary?.total_bills?.toLocaleString() || '0';
        document.getElementById('stat-passed').textContent = statsData.summary?.passed_bills?.toLocaleString() || '0';
      } catch (e) {
        console.log('Stats not loaded yet');
      }
    }

    // 国会トラッキングデータを読み込み
    async function loadDietTracking() {
      const owner = 'DaisukeHori';
      const repo = 'japan-law';

      // Open Issues (審議中の法案)
      try {
        const openRes = await fetch(
          `https://api.github.com/repos/${owner}/${repo}/issues?state=open&labels=法案&per_page=5`
        );
        const openIssues = await openRes.json();
        const openContainer = document.getElementById('open-issues');

        if (openIssues.length > 0) {
          openContainer.innerHTML = openIssues.map(issue => `
            <a href="${issue.html_url}" target="_blank"
               class="block p-2 border rounded hover:bg-gray-50">
              <span class="font-medium">${escapeHtml(issue.title)}</span>
              <span class="text-xs text-gray-500 ml-2">#${issue.number}</span>
            </a>
          `).join('');
        } else {
          openContainer.innerHTML = '<p class="text-gray-500">審議中の法案はありません</p>';
        }
      } catch (e) {
        document.getElementById('open-issues').innerHTML =
          '<p class="text-gray-500">データの取得に失敗しました</p>';
      }

      // Closed Issues (成立した法案)
      try {
        const closedRes = await fetch(
          `https://api.github.com/repos/${owner}/${repo}/issues?state=closed&labels=成立&per_page=5`
        );
        const closedIssues = await closedRes.json();
        const closedContainer = document.getElementById('closed-issues');

        if (closedIssues.length > 0) {
          closedContainer.innerHTML = closedIssues.map(issue => `
            <a href="${issue.html_url}" target="_blank"
               class="block p-2 border rounded hover:bg-gray-50">
              <span class="font-medium">${escapeHtml(issue.title)}</span>
              <span class="text-xs text-green-600 ml-2">成立 ✓</span>
            </a>
          `).join('');
        } else {
          closedContainer.innerHTML = '<p class="text-gray-500">まだ成立した法案はありません</p>';
        }
      } catch (e) {
        document.getElementById('closed-issues').innerHTML =
          '<p class="text-gray-500">データの取得に失敗しました</p>';
      }

      // Recent Commits
      try {
        const commitsRes = await fetch(
          `https://api.github.com/repos/${owner}/${repo}/commits?path=data/markdown&per_page=5`
        );
        const commits = await commitsRes.json();
        const commitsContainer = document.getElementById('recent-commits');

        if (commits.length > 0) {
          commitsContainer.innerHTML = commits.map(commit => `
            <a href="${commit.html_url}" target="_blank"
               class="block p-2 border rounded hover:bg-gray-50">
              <span class="font-medium">${escapeHtml(commit.commit.message.split('\n')[0])}</span>
              <span class="text-xs text-gray-500 ml-2">${commit.sha.slice(0, 7)}</span>
            </a>
          `).join('');
        } else {
          commitsContainer.innerHTML = '<p class="text-gray-500">まだコミットはありません</p>';
        }
      } catch (e) {
        document.getElementById('recent-commits').innerHTML =
          '<p class="text-gray-500">データの取得に失敗しました</p>';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    loadStats();
    loadDietTracking();
  </script>
</body>
</html>
